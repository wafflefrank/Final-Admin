<template>
  <!-- ËºâÂÖ•ËÆÄÂèñ -->
  <Loading :active="isLoading"></Loading>
  <div class="text-end mb-3">
    <button type="button" class="btn hotSort btn-sm me-3">Â∏≥Êà∂Á¥ÄÈåÑ</button>
    <button type="button" class="btn addBank_btn btn-sm" @click="addBank_visible = true">
      Êñ∞Â¢û
    </button>
    <!-- Êñ∞Â¢ûÊ®ôÁ±§Ë´áÁ™ó -->
    <!-- <TagsAdd ref="tagsAddModal"></TagsAdd> -->
  </div>
  <!-- ÁµÑË®≠ÁΩÆ  ‰∏äÂçäÈÉ®ÂàÜ-->
  <el-row>
    <el-col :span="24">
      <div class="mb-4 bg-purple-dark withdraw_content">
        <!-- Ë≥áÊñôË°®ÂñÆ -->
        <div>
          <el-form ref="search_form" :model="searchOption" class="demo-ruleForm">
            <el-row>
              <!-- Ë≥áÊñôÂÖßÂÆπ -->
              <el-col :span="24" class="add_left_style_1">
                <div class="d-flex justify-content-between">
                  <!-- ÈäÄË°åÈ°ûÂûã üçñ-->
                  <el-form-item label="ÈäÄË°åÈ°ûÂûã" class="companyAccount_style me-2" prop="bankType">
                    <el-select
                      v-model="searchOption.bankType"
                      placeholder="ÈÅ∏ÊìáÈäÄË°åÈ°ûÂûã"
                      @change="chooseBank_type(searchOption.bankType)"
                    >
                      <el-option
                        v-for="item in searchOption.bankType_options"
                        :key="item.id"
                        :label="item.bank_type"
                        :value="item"
                      ></el-option>
                    </el-select>
                  </el-form-item>
                  <!-- ÈäÄË°åÂêçÁ®± üçñ-->
                  <el-form-item label="ÈäÄË°åÂêçÁ®±" class="companyAccount_style me-2" prop="bankName">
                    <el-select
                      v-model="searchOption.bankName"
                      placeholder="ÈÅ∏ÊìáÈäÄË°å"
                      @change="chooseBank_name(searchOption.bankName)"
                    >
                      <el-option
                        v-for="item in searchOption.bankName_options"
                        :key="item.id"
                        :label="item.bank"
                        :value="item"
                      ></el-option>
                    </el-select>
                  </el-form-item>
                  <!-- Âπ£Âà• üçñ-->
                  <el-form-item label="Âπ£Âà•" class="companyAccount_style me-2" prop="bankName">
                    <el-select
                      v-model="searchOption.bankName"
                      placeholder="ÈÅ∏ÊìáÂπ£Âà•"
                      @change="chooseBank_name(searchOption.bankName)"
                    >
                      <el-option
                        v-for="item in searchOption.bankName_options"
                        :key="item.id"
                        :label="item.bank"
                        :value="item"
                      ></el-option>
                    </el-select>
                  </el-form-item>
                  <!-- Êî∂Ê¨æÁãÄÊÖã üçñ -->
                  <el-form-item
                    label="Êî∂Ê¨æÁãÄÊÖã"
                    class="companyAccount_style me-2"
                    prop="bank_transfer"
                  >
                    <el-select
                      v-model="searchOption.bank_transfer"
                      placeholder="ÈÅ∏ÊìáËΩâÂá∫ÈäÄË°å"
                      @change="chooseBank_transfer(searchOption.bank_transfer)"
                    >
                      <el-option
                        v-for="item in searchOption.bankTransfer_options"
                        :key="item.id"
                        :label="item.bank_cn"
                        :value="item"
                      ></el-option>
                    </el-select>
                  </el-form-item>
                  <!-- Âá∫Ê¨æÁãÄÊÖã üçñ -->
                  <el-form-item label="Âá∫Ê¨æÁãÄÊÖã" class="companyAccount_style me-2" prop="bank_link">
                    <el-select
                      v-model="searchOption.bank_link"
                      placeholder="ÈÅ∏ÊìáÁ∂ÅÂÆöÈäÄË°åÂç°"
                      @change="chooseBank_link(searchOption.bank_link)"
                    >
                      <el-option
                        v-for="item in searchOption.bankLink_options"
                        :key="item.id"
                        :label="item.bank_preset"
                        :value="item"
                      ></el-option>
                    </el-select>
                  </el-form-item>
                </div>
              </el-col>
            </el-row>
            <div class="text-center justify-content-between mt-3">
              <button type="button" class="btn btn-secondary me-1" @click.prevent="resetForm()">
                ÈáçÁΩÆ
              </button>
              <el-button class="editBtn ms-1" size="large" @click="imtScreen()">
                <el-icon class="Search fs-4"> <Search></Search></el-icon>
                ÊêúÂ∞ã
              </el-button>
            </div>
          </el-form>
        </div>
      </div></el-col
    >
  </el-row>
  <!-- ÂÖ¨Âè∏Âá∫ÂÖ•Ê¨æÂ∏≥Êà∂ ‰∏ãÂçäÈÉ®‰ªΩ -->
  <div class="d-flex justify-content-between">
    <h5 class="text-start mb-4 ms-2 mustType text-dark">ÂÖ¨Âè∏Âá∫ÂÖ•Ê¨æÂ∏≥Êà∂</h5>
  </div>
  <el-table
    ref="bankList_table"
    :data="companyList.bankList_table"
    style="width: 100%"
    :header-cell-class-name="classNameFunc"
    class="tags_table_style"
  >
    <el-table-column prop="id" label="#" align="center" width="50" />
    <el-table-column prop="bank" width="110" label="ÈäÄË°åÂêçÁ®±" sortable align="center">
    </el-table-column>
    <el-table-column prop="bank_cn" label="È°ØÁ§∫ÂêçÁ®±" align="center"> </el-table-column>
    <el-table-column prop="bank_type" width="90" label="ÈäÄË°åÈ°ûÂûã" align="center" />
    <el-table-column prop="bank" label="Â∏≥Êà∂ÂêçÁ®±" align="center">
      <template v-slot="{ row }">
        <el-tag :type="row.bank === 'CTBC' ? 'danger' : 'success'">
          {{ 'V' }}
        </el-tag>
      </template>
    </el-table-column>
    <el-table-column prop="" width="90" label="Âπ£Âà•" align="center" />
    <el-table-column prop="url" label="Á∂≤ÈäÄÁ∂≤ÂùÄ" align="center" />
    <el-table-column prop="img" label="ÂúñÁâá" width="200" align="center" class="image_size">
      <!--ÊèíÂÖ•ÂúñÁâá-->
      <template v-slot="scope" class="image_size">
        <img class="image_size" :src="imageUrl + scope.row.img" alt="" />
      </template>
    </el-table-column>

    <el-table-column width="110" prop="" label="Êìç‰Ωú" align="center">
      <template #default="scope">
        <el-button class="editBtn2" size="small" @click="openModal(scope.row)"
          ><el-icon class="edit"> <Edit></Edit></el-icon>
        </el-button>
      </template>
    </el-table-column>
    <el-table-column sortable width="110" prop="withdraw_amount" label="ËΩâÂá∫ÈäÄË°å" align="center" />
    <el-table-column width="110" prop="withdraw_amount" label="Á∂ÅÂÆöÈäÄË°åÂç°" align="center" />
  </el-table>
</template>

<script>
import _ from 'lodash';

export default {
  data() {
    return {
      isLoading: false, // ËΩâÂúàËÆÄÊ¢ù
      // ‰∏äÊñπÊêúÂ∞ãÂçÄÈñì
      searchOption: {
        bankName: '',
        bankType: '',
        bank_transfer: '', // ÈäÄË°åËΩâÂá∫È°ØÁ§∫
        bank_link: '', // ÈäÄË°åÁ∂ÅÂÆö
        bankName_options: [], // ÈäÄË°åÈ°ûÂûã‰∏ãÊãâÈÅ∏È†Ö
        bankType_options: [], // ÈäÄË°åÈ°ûÂûã‰∏ãÊãâÈÅ∏È†Ö
        bankTransfer_options: [], // ÈäÄË°åËΩâÂá∫È°ØÁ§∫‰∏ãÊãâÈÅ∏È†Ö
        bankLink_options: [], // Á∂ÅÂÆöÈäÄË°åÂç°È°ØÁ§∫‰∏ãÊãâÈÅ∏È†Ö
      },
      //  ‰∏ãÊñπtable
      companyList: {
        skip: '0', // Ë∑≥ÈÅéÂπæÁ≠Ü
        limit: '20', // ‰∏ÄÊ¨°ÂπæÁ≠Ü
        order: 'ASC', // IDÊéíÂ∫èÊñπÂºè(DESC , ASC )
        orderType: 'id', // È§òÈ°çÊéíÂ∫è( Ëº∏ÂÖ•... money )
        companyList_table: [], // ÈäÄË°åÂàóË°®Ë≥áÊñôÈ°ØÁ§∫
        filterTableData: [], // ÁØ©ÈÅ∏ÂæåÂÑ≤Â≠òË≥áÊñôÁöÑÂú∞Êñπ
      },
    };
  },
  methods: {
    // ÂèñÂæóÊèêÊ¨æÂàóË°®üç≥
    getCompany_list() {
      const testapi = `${process.env.VUE_APP_TESTAPI}`;
      this.isLoading = true;
      this.$http
        .get(
          `${testapi}/backend/financ/financeAccount?skip=${this.companyList.skip}&limit=${this.companyList.limit}&order=${this.companyList.order}&orderType`,
        )
        .then((res) => {
          this.isLoading = false;
          if (res.data.code === 200) {
            console.log(res.data.data);
            this.companyList.companyList_table = res.data.data.list;
            // this.searchOption.bankName_options = res.data.data.list;
            // this.searchOption.bankType_options = res.data.data.list;
            // this.searchOption.bankTransfer_options = res.data.data.list;
            // this.searchOption.bankLink_options = res.data.data.list;
            _.forEach(this.companyList.companyList_table, (item, key) => {
              console.log(item, key);
            });
            // console.log(this.withdrawList.withdrawTable);

            // ÁØ©ÈÅ∏ÈáçË§áÁöÑÈäÄË°åÂêç
            this.searchOption.bankName_options = _.uniqBy(
              this.searchOption.bankName_options,
              (item) => item.bank_cn,
            );
            // ÁØ©ÈÅ∏ÈáçË§áÁöÑÈäÄË°åÈ°ûÂûã
            this.searchOption.bankType_options = _.uniqBy(
              this.searchOption.bankType_options,
              (item) => item.bank_type,
            );
            // ÁØ©ÈÅ∏ËΩâÂá∫ÁöÑÈäÄË°åÈ°ØÁ§∫
            this.searchOption.bankTransfer_options = _.uniqBy(
              this.searchOption.bankTransfer_options,
              (item) => item.bank,
            );
            // ÁØ©ÈÅ∏Á∂ÅÂÆöÁöÑÈäÄË°åÈ°ØÁ§∫
            this.searchOption.bankLink_options = _.uniqBy(
              this.searchOption.bankLink_options,
              (item) => item.bank,
            );
          }
        });
    },
    // ÈáçÁΩÆÊêúÂ∞ãË°®ÂñÆ
    resetForm() {
      this.$refs.search_form.resetFields(); // el.form.itemË£°Èù¢ÁöÑprop‰∏ÄÂÆöË¶Å‰∏ç‰∏ÄÊ®£
      this.getBank_list();
    },
  },
  created() {
    this.getCompany_list();
  },
};
</script>

<style lang="scss">
.withdraw_content {
  padding: 25px 15px 25px;
  border-radius: 10px;
  flex-wrap: wrap;
  // min-height: 36px;
}
.bg-purple-dark {
  background: #eff3f8;
}
.editBtn {
  background: #0b5ed7;
  color: #fff;
  &:hover {
    transition: 0.5s;
    background: #236aa5;
    color: #fff;
  }
}
.companyAccount_style .el-input__inner {
  width: 100%;
  padding: 0 100px 0 10px;
  border: 1px solid #dcdfe6;
  &:focus {
    border-color: #409eff !important;
  }
}
.input_disable_style .el-input.is-disabled .el-input__inner {
  width: 100%;
  padding: 0 50px;
  background: #f5f7fa;
  color: #c0c4cc;
  border: 1px solid #dcdfe6;
  &:focus {
    border-color: #409eff !important;
  }
}
.header_title_dark {
  background: #575656 !important;
  color: white;
  text-align: center !important;
}
.header_title_light {
  background: #888686 !important;
  color: white;
  text-align: center !important;
}
.tags_table_style {
  border-radius: 10px;
}
// Êñ∞Â¢ûÈäÄË°åÊåâÈàïÊ®£Âºè
.addBank_btn,
.hotSort {
  background: #2f2f2f;
  color: #fff;
  &:hover {
    background: #0f0f0f !important;
    color: white;
  }
}
.bankDetail_style .el-input__inner {
  border: none;
  border-bottom: 1px solid #dcdfe6;
  padding: 20px 0;
}
.image_size {
  width: 100%;
  height: 50px;
  object-fit: cover;
}
</style>
